<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ho ho - very</title>
</head>

<body>
    <h2>Formulario de registro</h2>
    <form method="POST" onsubmit="enviar(event);">
        <input id="nombre" name="nombre" type="text" required placeholder="Tu nombre" /><br />
        <input id="email" name="email" type="email" required placeholder="Correo electrónico" /><br />
        <input id="contraseña" name="contraseña" type="password" required placeholder="Contraseña" /><br />
        <input id="esadmin" name="esadmin" type="checkbox" placeholder="Es admin" /><br />
        <input type="submit" value="Registrar" />
        <input type="reset" value="Limpiar" id="limpiador" />
    </form>
    <h2>Lista de Usuarios</h2>
    <table border="1">
        <thead>
            <th>Código</th>
            <th>Nombre Completo</th>
            <th>Correo Electrónico</th>
            <th>Es admin?</th>
            <th></th>
        </thead>
        <tbody id="tabla"></tbody>
    </table>
    <button onclick="actualizarDatos()">Actualizar</button>
    <script>
        function enviar(event) {
            event.preventDefault();
            let nc = document.getElementById("nombre").value;
            let em = document.getElementById("email").value;
            let pass = document.getElementById("contraseña").value;
            let ck = document.getElementById("nombre").checked;

            let usuario = {
                nombre_completo: nc,
                email: em,
                password: pass,
                idadmin: ck
            }
            fetch('http://localhost/hohovery/api/?endpoint=usuario',
                {
                    method: 'POST',
                    body: JSON.stringify(usuario)
                }
            ).then(respuesta => {
                actualizarDatos();
                document.getElementById("limpiador").click();
            }).catch(e => {
                alert("Error al registrar");
            })
        }
        function actualizarDatos() {
            fetch('http://localhost/hohovery/api/?endpoint=usuario')
                .then(respuesta => respuesta.json())
                .then(datos => {
                    console.log(datos);
                    let datosHTML = "";
                    for (let i = 0; i < datos.length; i++) {
                        datosHTML += "<tr><td>" + datos[i].id + "</td><td>" + datos[i].nombre_completo + "</td><td>" + datos[i].email + "</td><td>" + datos[i].isadmin + "</td><td></td></tr>"
                    }
                    document.getElementById("tabla").innerHTML = datosHTML;
                })
                .catch(err => {
                    console.warn(err);
                    alert("No se obtener los datos.");
                })
        }        
    </script>
</body>

</html>